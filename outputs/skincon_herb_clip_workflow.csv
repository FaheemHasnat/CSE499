Step,Cell_Number,Section,Description,Input,Output,Key_Functions,Notes
1,1-2,Setup,Import required libraries and check environment,"None","Library imports, device configuration (CUDA/CPU)","pandas, numpy, torch, transformers.CLIPModel, PIL","Checks for Google Colab environment and GPU availability"
2,3-4,Configuration,Mount Google Drive and configure paths,"Google Drive mount","BASE_DIR, HERB_FILE, SKINCON_FILE, IMAGE_FOLDER, OUTPUT_DIR paths","drive.mount(), os.path.join(), Path.mkdir()","Creates output directories for embeddings and results"
3,5-6,Data Loading,Load herb and skincon datasets,"herb2_final_clean.csv, skincon_preprocessed.csv","herb_df, skincon_df dataframes","pd.read_csv()","Filters herb dataset for 'Skin and Connective Tissue Diseases' only"
4,5,Data Merging,Merge herb and skincon datasets on disease names,"herb_df, skincon_df","matched_df (skincon_herb_matched_SKIN_ONLY.csv)","DataFrame.merge(), str.lower(), str.strip()","Inner join on normalized disease names; creates Herb_Name, Herb_Function, Disease_Name columns"
5,7-10,Data Exploration,Preview and explore merged dataset,"matched_df","Display of sample data","display(), DataFrame.head()","Shows herb information linked to skin conditions"
6,11,Text Preparation,Create herb treatment descriptions,"matched_df with Herb_Name, Herb_Function, Disease_Name","herb_description column","create_herb_description()","Combines herb name, function, disease name, and aliases into descriptive text"
7,12,Image Validation,Verify image files exist in subdirectories,"IMAGE_FOLDER path, filename column","image_path column, image_exists flag","glob.glob(recursive=True), os.path.exists()","Recursively searches subdirectories; filters dataset to only existing images"
8,13-14,Model Loading,Load CLIP model and processor,"MODEL_NAME: 'openai/clip-vit-base-patch32'","model, processor objects","CLIPModel.from_pretrained(), CLIPProcessor.from_pretrained()","Loads model to GPU/CPU; shows embedding dimensions (vision & text)"
9,15,Text Encoding,Encode herb descriptions with CLIP text encoder,"herb_description texts (list)","herb_embeddings tensor (N x 512)","encode_texts(), model.get_text_features(), normalization","Batch processing (batch_size=32); L2 normalized embeddings"
10,16,Train/Test Split,Split images into 70% train and 30% test,"all_images list from recursive search","train_imgs, test_imgs lists","train_test_split(test_size=0.3, random_state=42)","Stratified split to maintain distribution"
11,17,Image Encoding,Encode skin images with CLIP vision encoder,"image_path list, PIL images","image_embeddings tensor (N x 512), valid_indices","encode_images(), model.get_image_features(), normalization","Batch processing (batch_size=16); handles missing images; L2 normalized embeddings"
12,18,Similarity Computation,Calculate cosine similarity between images and texts,"image_embeddings, herb_embeddings","similarity_matrix (images x herbs)","torch matrix multiplication (@)","Similarity scores range from -1 to 1; shows min/max/mean statistics"
13,19,Ranking,Find top-5 herb matches for each image,"similarity_matrix","top_scores, top_indices (K=5)","torch.topk(k=5, dim=1)","Returns top 5 most similar herbs per image"
14,20,Results Display,Display top-5 matches for sample images,"top_scores, top_indices, skincon_df","Console output of predictions","Iterates through results, displays herb names/functions","Shows first 5 images with their top-5 herb matches"
15,21,Results Export,Save predictions to CSV,"results list with all predictions","skincon_herb_clip_results_SKIN_ONLY.csv","pd.DataFrame(), to_csv()","Columns: image_filename, skin_condition_label, rank, similarity_score, herb_name, herb_function, disease_name, disease_alias, full_description, disease_class"
16,22,Visualization,Create visualization of image with herb match,"image_path, herb information","PNG visualization files, matplotlib plots","Image.open(), plt.subplots(), plt.savefig()","2-panel layout: image on left, herb details on right"
17,23,Summary Statistics,Calculate and display summary statistics,"similarity_matrix, top_scores","Console output with statistics","mean(), std(), min(), max(), value_counts()","Overall similarity stats, top-match stats, disease distribution, unique disease count"
